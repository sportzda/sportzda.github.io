<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "tozdf538hj");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cricket Bat Machine Knocking Service | 10k-30k Balls | DA SPORTZ</title>
    <meta name="description"
        content="Professional cricket bat machine knocking service in India. Choose from 10,000 to 30,000 balls packages. Expert bat preparation, threading, and oiling services. Fast turnaround, competitive pricing." />
    <meta name="keywords"
        content="cricket bat knocking, bat knocking service, machine bat knocking, cricket bat preparation, bat knocking 10000 balls, bat knocking 20000 balls, cricket bat threading, bat oiling service, cricket equipment, DA SPORTZ" />
    <link rel="canonical" href="https://dasportz.com/bat-knocking.html" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Cricket Bat Machine Knocking | DA SPORTZ">
    <meta property="og:description"
        content="Professional cricket bat machine knocking service. Choose from 10,000 to 30,000 balls packages. Expert bat preparation at DA SPORTZ.">
    <meta property="og:image" content="https://dasportz.com/favicon.png">
    <meta property="og:url" content="https://dasportz.com/bat-knocking.html">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cricket Bat Machine Knocking | DA SPORTZ">
    <meta name="twitter:description"
        content="Professional cricket bat machine knocking service. Choose from 10,000 to 30,000 balls packages.">
    <meta name="twitter:image" content="https://dasportz.com/favicon.png">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "Cricket Bat Machine Knocking",
      "description": "Professional cricket bat machine knocking service with packages from 10,000 to 30,000 balls. Includes threading and oiling.",
      "provider": {
        "@type": "LocalBusiness",
        "name": "DA SPORTZ",
        "url": "https://dasportz.com"
      },
      "offers": [
        {
          "@type": "Offer",
          "name": "10,000 Balls Package",
          "priceCurrency": "INR",
          "price": "699"
        },
        {
          "@type": "Offer",
          "name": "20,000 Balls Package",
          "priceCurrency": "INR",
          "price": "999"
        },
        {
          "@type": "Offer",
          "name": "30,000 Balls Package",
          "priceCurrency": "INR",
          "price": "1249"
        }
      ]
    }
    </script>

    <!-- Bootstrap and Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        /* === SITE THEME / COLORS / FONTS === */
        :root {
            --primary-color: #1f1f1f;
            --accent-color: #ff5900;
            --nav-hover: #ff5900;
            --bg-light: #f4f4f4;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Barlow', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            background-color: var(--bg-light);
            color: var(--primary-color);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .btn-custom {
            background-color: var(--accent-color);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            font-family: 'Barlow', sans-serif;
            letter-spacing: 0.5px;
            transition: all 0.3s ease-in-out;
            margin-top: 1rem;
            cursor: pointer;
        }

        .btn-custom:hover:not(:disabled) {
            background-color: #e04800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-custom:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .section-title {
            font-family: 'Barlow', sans-serif;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin-top: 2rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            display: block;
            height: 3px;
            width: 80px;
            background: var(--accent-color);
            margin: 0.5rem auto 2rem;
        }

        .top-bar {
            background-color: var(--primary-color);
            color: #fff;
            font-size: 0.9rem;
        }

        .top-bar a {
            color: #fff;
            text-decoration: none;
        }

        .offer-bar {
            background-color: var(--accent-color);
            color: #fff;
            font-weight: 500;
            font-size: 0.95rem;
        }

        nav.navbar {
            background: #ffffff;
            border-bottom: 1px solid #e1e1e1;
            font-family: 'Barlow', sans-serif;
            font-size: 0.95rem;
        }

        .navbar-brand {
            font-family: 'Barlow', sans-serif;
            font-weight: 800;
            font-size: 2rem;
            letter-spacing: 1px;
            color: var(--primary-color) !important;
        }

        .nav-link {
            font-weight: 500;
            color: var(--primary-color) !important;
            position: relative;
        }

        .nav-link::after {
            content: '';
            display: block;
            height: 2px;
            width: 0;
            background: var(--nav-hover);
            transition: width 0.3s ease-in-out;
            position: absolute;
            bottom: -6px;
            left: 0;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }

        .form-label {
            font-weight: 500;
            color: var(--primary-color);
        }

        .card {
            border: none;
            border-radius: 0.5rem;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .card-body {
            padding: 2rem;
        }

        .table {
            font-family: 'Barlow', sans-serif;
        }

        .table th {
            background: var(--bg-light);
            color: var(--primary-color);
            font-weight: 600;
        }

        .table td {
            color: var(--primary-color);
        }

        footer {
            background: var(--primary-color);
            color: #fff;
            padding: 2rem 0 1rem 0;
        }

        footer a {
            color: var(--accent-color);
        }

        .muted {
            color: #6c6c6c;
            font-size: .95rem;
        }

        .bat-card {
            border-radius: 10px;
            border: 1px solid #eee;
            padding: 12px;
            background: #fff;
        }

        @media (max-width: 768px) {
            .card-body {
                padding: 1rem;
            }

            .section-title {
                font-size: 1.5rem;
            }
        }

        /* Conditions Block */
        .conditions {
            background-color: rgba(255, 89, 0, 0.1);
            border: 1px solid rgba(255, 89, 0, 0.3);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: background-color 0.3s ease;
        }

        .conditions:hover {
            background-color: rgba(255, 89, 0, 0.15);
        }

        .conditions h5 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
            padding-left: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .conditions .highlight-condition {
            color: var(--accent-color);
            font-weight: 600;
            border-left: 4px solid var(--accent-color);
            padding: 0.5rem 0.75rem;
            margin: 0.5rem 0;
            background: rgba(255, 89, 0, 0.1);
            border-radius: 0.25rem;
        }

        .conditions label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--primary-color);
            cursor: pointer;
        }

        .small-muted {
            font-size: 0.9rem;
            color: #6c6c6c;
        }

        /* Test mode indicator */
        .test-mode-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: red;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
    <!-- Test Mode Indicator -->
    <div id="testModeIndicator" class="test-mode-indicator" style="display: none;">
        TEST MODE ENABLED
    </div>

    <!-- Offer Bar -->
    <div class="offer-bar text-center py-2">
        üèè Professional Cricket Bat Machine Knocking Service | Get your bat match-ready! üèè
    </div>

    <!-- Top Bar -->
    <div class="top-bar py-2 border-bottom">
        <div class="container d-flex justify-content-between align-items-center flex-wrap">
            <div class="d-flex align-items-center gap-3">
                <span><i class="bi bi-telephone"></i> +91-8800505769</span>
                <span><i class="bi bi-envelope"></i> contact@dasportz.com</span>
            </div>
            <div class="d-flex align-items-center gap-3 mt-2 mt-md-0">
                <a href="https://g.co/kgs/n2Rg2j5" target="_blank" class="text-white"><i class="bi bi-google"></i>
                    Google Business</a>
                <a href="https://www.instagram.com/da.sportz?igsh=MW5jZGNxamVhMm1vaA%3D%3D&utm_source=qr"
                    class="text-white"><i class="bi bi-instagram"></i></a>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">DA SPORTZ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between align-items-center" id="navbarNav">
                <ul class="navbar-nav ms-auto d-flex align-items-center">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="bi bi-house"></i> Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#about"><i class="bi bi-info-circle"></i>
                            About</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#contact"><i
                                class="bi bi-envelope-open"></i> Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="stringing-booking.html"><i
                                class="bi bi-activity"></i> String My Racket</a></li>
                    <li class="nav-item"><a class="nav-link active" href="bat-knocking.html"><i
                                class="bi bi-hammer"></i> Bat Knocking</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Form Section -->
    <section class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h2 class="section-title mb-1">üèè Cricket Bat Machine Knocking</h2>
                            <p class="muted mb-3">üèè Get your bat match-ready with professional machine knocking
                                service!
                            </p>

                            <!-- Video Section -->
                            <div class="mb-4">
                                <div class="ratio ratio-16x9"
                                    style="border-radius: 0.5rem; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                    <video controls autoplay muted loop playsinline preload="metadata"
                                        style="object-fit: contain; background-color: #000;">
                                        <source src="bat_knocking_video.mp4" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                                <p class="text-center text-muted small mt-2">Watch our professional bat knocking process
                                    in action</p>
                            </div>

                            <form id="batKnockingForm" novalidate>
                                <!-- Store Select -->
                                <div class="mb-3">
                                    <label for="storeLocation" class="form-label">Select Store</label>
                                    <select id="storeLocation" class="form-select" required>
                                        <option value="">-- Choose Store --</option>
                                        <option selected>Gaur City 1</option>
                                        <option>Gaur City 2</option>
                                    </select>
                                </div>

                                <!-- Customer Name -->
                                <div class="mb-3">
                                    <label for="customerName" class="form-label">Your Name</label>
                                    <input type="text" id="customerName" class="form-control" required
                                        placeholder="Enter your full name">
                                </div>

                                <!-- Phone -->
                                <div class="mb-3">
                                    <label for="phone" class="form-label">WhatsApp Number for Real-Time Updates
                                        üì±</label>
                                    <input type="tel" id="phone" class="form-control"
                                        placeholder="10-digit WhatsApp number for order updates" pattern="[0-9]{10}"
                                        maxlength="10" required>
                                    <small class="text-muted">You'll receive real-time order status updates via
                                        WhatsApp</small>
                                </div>

                                <hr />

                                <!-- Bats List (dynamic) -->
                                <div id="batsContainer"></div>

                                <div class="d-flex gap-2 mb-3">
                                    <button type="button" id="addBatBtn" class="btn btn-outline-dark btn-sm">
                                        + Add Another Bat
                                    </button>
                                    <button type="button" id="removeBatBtn" class="btn btn-outline-danger btn-sm">
                                        - Remove Last Bat
                                    </button>
                                </div>

                                <!-- Pickup & Drop -->
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="pickupDrop">
                                    <label class="form-check-label" for="pickupDrop">
                                        Pickup & Drop by porter (charges borne by customer)
                                    </label>
                                </div>

                                <!-- Payment Method -->
                                <div class="mb-3">
                                    <label for="paymentMethod" class="form-label">Payment Method</label>
                                    <select id="paymentMethod" class="form-select" required>
                                        <option value="">-- Select Payment Method --</option>
                                        <option value="online" selected>Online Payment</option>
                                        <option value="payatoutlet">Cash</option>
                                    </select>
                                </div>

                                <!-- Discount Coupon -->
                                <div class="mb-3">
                                    <label for="discountCoupon" class="form-label text-muted small">Have a discount
                                        coupon?</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control form-control-sm text-uppercase"
                                            id="discountCoupon" placeholder="Enter coupon code" maxlength="6"
                                            pattern="^DA[0-9]*$">
                                        <button class="btn btn-outline-secondary btn-sm" type="button"
                                            id="applyCoupon">Apply</button>
                                    </div>
                                    <div id="couponFeedback" class="invalid-feedback small" style="display: none;">
                                        Invalid coupon
                                    </div>
                                    <div id="couponSuccess" class="valid-feedback small" style="display: none;">
                                        Coupon applied successfully!
                                    </div>
                                </div>

                                <!-- Summary -->
                                <div class="card p-3 mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong id="summaryCount">0</strong> bat(s)
                                        </div>
                                        <div>
                                            <strong>Total: ‚Çπ<span id="summaryTotal">0</span></strong>
                                        </div>
                                    </div>
                                    <div class="alert alert-info mb-0 mt-2 py-2" style="font-size: 0.875rem;">
                                        <i class="bi bi-whatsapp"></i> <strong>Real-Time WhatsApp Updates:</strong>
                                        Track your order status live! We'll send you instant notifications on WhatsApp
                                        when:
                                        <ul class="mb-0 mt-1 ps-3" style="font-size: 0.8rem;">
                                            <li>Order is confirmed</li>
                                            <li>Knocking service starts</li>
                                            <li>Service is completed</li>
                                            <li>Ready for pickup</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Terms & Conditions -->
                                <div id="service-notes" class="conditions">
                                    <h5>Important Service Notes</h5>

                                    <ul>
                                        <li><strong>üèè Service Details:</strong> Professional machine knocking service
                                            to prepare your bat for match play. Service duration:
                                            <strong>25 minutes to 3 hours</strong> depending on the package selected.
                                        </li>

                                        <li><strong>‚ö° Safety:</strong> We handle your bat with utmost care. However,
                                            bats with existing cracks or damage may not be suitable for knocking.
                                            <strong>We cannot be held responsible for pre-existing defects.</strong>
                                        </li>

                                        <li><strong>üí∞ Pricing:</strong>
                                            <ul>
                                                <li>10,000 balls: ‚Çπ800 (25 minutes)</li>
                                                <li>15,000 balls: ‚Çπ1,100 (40 minutes)</li>
                                                <li>20,000 balls: ‚Çπ1,500 (50 minutes)</li>
                                                <li>25,000 balls: ‚Çπ1,800 (65 minutes)</li>
                                                <li>30,000 balls: ‚Çπ2,000 (75 minutes)</li>
                                            </ul>
                                        </li>

                                        <li><strong>üì¶ Pickup & Storage:</strong> Collect within <strong>7 days</strong>
                                            after completion to avoid storage charges. Pickup/Drop via porter is extra.
                                            <strong>We are
                                                not responsible for damage during transit.</strong>
                                        </li>

                                        <li><strong>üéØ Post-Service:</strong> After knocking, apply linseed oil
                                            regularly and allow the bat to rest for 24-48 hours before use.</li>
                                    </ul>
                                </div>

                                <p style="font-size:0.9rem; color:#555;">
                                    By clicking "Pay Now," you confirm you've read and agree to our
                                    <a href="#service-notes" style="color:#007bff;">service notes</a>.
                                </p>

                                <button id="confirmButton" type="button" class="btn-custom w-100">
                                    Pay Now
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Collapsible Pricing Table -->
            <div class="text-center mt-5">
                <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse"
                    data-bs-target="#pricingTable">
                    View Knocking Packages & Pricing
                </button>
            </div>

            <div class="collapse mt-3" id="pricingTable">
                <div class="card card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Package</th>
                                    <th>Number of Balls</th>
                                    <th>Service Duration</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Basic</td>
                                    <td>10,000 balls</td>
                                    <td>25 minutes</td>
                                    <td><strong>‚Çπ800</strong></td>
                                </tr>
                                <tr>
                                    <td>Standard</td>
                                    <td>15,000 balls</td>
                                    <td>40 minutes</td>
                                    <td><strong>‚Çπ1,100</strong></td>
                                </tr>
                                <tr>
                                    <td>Premium</td>
                                    <td>20,000 balls</td>
                                    <td>50 minutes</td>
                                    <td><strong>‚Çπ1,500</strong></td>
                                </tr>
                                <tr>
                                    <td>Elite</td>
                                    <td>25,000 balls</td>
                                    <td>65 minutes</td>
                                    <td><strong>‚Çπ1,800</strong></td>
                                </tr>
                                <tr>
                                    <td>Professional</td>
                                    <td>30,000 balls</td>
                                    <td>75 minutes</td>
                                    <td><strong>‚Çπ2,000</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="muted small mt-3 mb-0">All prices are inclusive of machine knocking service. Pickup &
                            Drop charges extra if opted.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="mt-5">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase">DA SPORTZ</h5>
                    <p>Your one-stop shop for premium sports gear. Trusted by players. Loved by champions.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase">Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#about">About Us</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="refund_cancellation.html">Refund & Cancellation</a></li>
                        <li><a href="https://g.co/kgs/n2Rg2j5" target="_blank">Google Reviews</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5 class="text-uppercase">Follow Us</h5>
                    <a href="https://www.instagram.com/da.sportz?igsh=MW5jZGNxamVhMm1vaA%3D%3D&utm_source=qr"
                        class="me-3"><i class="bi bi-instagram"></i></a>
                    <a href="mailto:contact@dasportz.com"><i class="bi bi-envelope"></i></a>
                </div>
            </div>
            <div class="text-center pt-3 border-top border-secondary">
                <small>&copy; 2025 DA SPORTZ. All Rights Reserved.</small>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>

    <!-- Config -->
    <script src="js/config.js"></script>

    <!-- Zoho widget + payment handling script -->
    <script src="https://static.zohocdn.com/zpay/zpay-js/v1/zpayments.js"></script>
    <script>
        (function () {
            const BACKEND_BASE = window.CONFIG?.BACKEND_BASE || 'http://localhost:3000';
            const ZOHO_WIDGET_API_KEY = window.CONFIG?.ZOHO_WIDGET_API_KEY;

            // Check if test mode is enabled via URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const testMode = urlParams.get('test') === 'true';

            if (testMode) {
                document.getElementById('testModeIndicator').style.display = 'block';
            }

            /* ---------- Price map for knocking packages ---------- */
            const PRICE_MAP = {
                "10000": 800,
                "15000": 1100,
                "20000": 1500,
                "25000": 1800,
                "30000": 2000
            };

            // Add test product if in test mode
            if (testMode) {
                PRICE_MAP["100"] = 1;
            }

            /* ---------- DOM refs ---------- */
            const batsContainer = document.getElementById('batsContainer');
            const addBtn = document.getElementById('addBatBtn');
            const removeBtn = document.getElementById('removeBatBtn');
            const summaryCountEl = document.getElementById('summaryCount');
            const summaryTotalEl = document.getElementById('summaryTotal');
            const paymentMethodSelect = document.getElementById('paymentMethod');
            const confirmButton = document.getElementById('confirmButton');
            const storeSelect = document.getElementById('storeLocation');
            const nameInput = document.getElementById('customerName');
            const phoneInput = document.getElementById('phone');
            const pickupDrop = document.getElementById('pickupDrop');

            /* ---------- Create package select dropdown ---------- */
            function createPackageSelect(selected = '') {
                const select = document.createElement('select');
                select.className = 'form-select form-select-sm packageType';
                select.required = true;

                const placeholder = document.createElement('option');
                placeholder.value = '';
                placeholder.textContent = '-- Select Package --';
                select.appendChild(placeholder);

                const packages = [
                    { balls: '10000', name: 'Basic (10,000 balls)', price: 800 },
                    { balls: '15000', name: 'Standard (15,000 balls)', price: 1100 },
                    { balls: '20000', name: 'Premium (20,000 balls)', price: 1500 },
                    { balls: '25000', name: 'Elite (25,000 balls)', price: 1800 },
                    { balls: '30000', name: 'Professional (30,000 balls)', price: 2000 }
                ];

                if (testMode) {
                    packages.unshift({ balls: '100', name: 'TEST PACKAGE (100 balls)', price: 1 });
                }

                packages.forEach(pkg => {
                    const opt = document.createElement('option');
                    opt.value = pkg.balls;
                    opt.textContent = `${pkg.name} ‚Äî ‚Çπ${pkg.price}`;
                    if (pkg.balls === selected) opt.selected = true;
                    select.appendChild(opt);
                });

                return select;
            }

            /* ---------- Create bat row ---------- */
            function createBatRow(prefill = {}) {
                const row = document.createElement('div');
                row.className = 'bat-card mb-3 p-3';

                // Bat Model Name
                const col0 = document.createElement('div');
                col0.className = 'mb-2';
                const label0 = document.createElement('label');
                label0.className = 'form-label small mb-1';
                label0.textContent = 'Bat Model *';
                col0.appendChild(label0);
                const batModelInput = document.createElement('input');
                batModelInput.type = 'text';
                batModelInput.className = 'form-control form-control-sm batModel';
                batModelInput.placeholder = 'Enter bat model name';
                batModelInput.required = true;
                if (prefill.batModel) batModelInput.value = prefill.batModel;
                col0.appendChild(batModelInput);
                row.appendChild(col0);

                // Row for Package and Quantity
                const flexRow1 = document.createElement('div');
                flexRow1.className = 'd-flex flex-wrap gap-2 mb-2';

                // Package Type
                const col1 = document.createElement('div');
                col1.style.flex = '1 1 220px';
                const label1 = document.createElement('label');
                label1.className = 'form-label small mb-1';
                label1.textContent = 'Knocking Package';
                col1.appendChild(label1);
                col1.appendChild(createPackageSelect(prefill.package || ''));
                flexRow1.appendChild(col1);

                // Quantity
                const col2 = document.createElement('div');
                col2.style.width = '110px';
                const label2 = document.createElement('label');
                label2.className = 'form-label small mb-1';
                label2.textContent = 'Quantity';
                col2.appendChild(label2);
                const qty = document.createElement('input');
                qty.type = 'number';
                qty.min = '1';
                qty.value = prefill.qty || 1;
                qty.className = 'form-control form-control-sm quantity';
                col2.appendChild(qty);
                flexRow1.appendChild(col2);

                row.appendChild(flexRow1);

                // Extra Services Section
                const extraServicesDiv = document.createElement('div');
                extraServicesDiv.className = 'mb-2';
                const uniqueId = Date.now() + '_' + Math.random();
                extraServicesDiv.innerHTML = `
                    <label class="form-label small mb-2">Extra Services (Optional)</label>
                    <div class="form-check">
                        <input class="form-check-input threading-top" type="checkbox" id="threading_top_${uniqueId}">
                        <label class="form-check-label small" for="threading_top_${uniqueId}">
                            Bat Threading Top ‚Äî ‚Çπ100
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input threading-bottom" type="checkbox" id="threading_bottom_${uniqueId}">
                        <label class="form-check-label small" for="threading_bottom_${uniqueId}">
                            Bat Threading Bottom ‚Äî ‚Çπ100
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input threading-both" type="checkbox" id="threading_both_${uniqueId}">
                        <label class="form-check-label small" for="threading_both_${uniqueId}">
                            Bat Threading Top & Bottom ‚Äî ‚Çπ150
                        </label>
                    </div>
                    <div class="text-muted small mt-1">
                        <i class="bi bi-gift"></i> Bat oiling is FREE with all packages!
                    </div>
                `;
                row.appendChild(extraServicesDiv);

                // Line Total
                const totalRow = document.createElement('div');
                totalRow.className = 'd-flex justify-content-between align-items-center mt-2 pt-2 border-top';
                const label3 = document.createElement('label');
                label3.className = 'form-label small mb-0';
                label3.textContent = 'Line Total';
                const priceBadge = document.createElement('div');
                priceBadge.className = 'fw-bold text-primary';
                priceBadge.textContent = '‚Çπ0';
                priceBadge.style.fontSize = '1.1rem';
                totalRow.appendChild(label3);
                totalRow.appendChild(priceBadge);
                row.appendChild(totalRow);

                // Listeners
                row.querySelector('.packageType').addEventListener('change', updateAllTotals);
                row.querySelector('.quantity').addEventListener('input', updateAllTotals);

                // Threading checkbox listeners with mutual exclusion logic
                const topCheckbox = row.querySelector('.threading-top');
                const bottomCheckbox = row.querySelector('.threading-bottom');
                const bothCheckbox = row.querySelector('.threading-both');

                topCheckbox.addEventListener('change', function () {
                    if (this.checked && bothCheckbox.checked) {
                        bothCheckbox.checked = false;
                    }
                    updateAllTotals();
                });

                bottomCheckbox.addEventListener('change', function () {
                    if (this.checked && bothCheckbox.checked) {
                        bothCheckbox.checked = false;
                    }
                    updateAllTotals();
                });

                bothCheckbox.addEventListener('change', function () {
                    if (this.checked) {
                        topCheckbox.checked = false;
                        bottomCheckbox.checked = false;
                    }
                    updateAllTotals();
                });

                row._priceEl = priceBadge;
                return row;
            }

            function addInitialRow() {
                const r = createBatRow();
                batsContainer.appendChild(r);
                updateAllTotals();
            }

            addBtn.addEventListener('click', function () {
                const r = createBatRow();
                batsContainer.appendChild(r);
                r.scrollIntoView({ behavior: 'smooth', block: 'center' });
                updateAllTotals();
            });

            removeBtn.addEventListener('click', function () {
                const rows = batsContainer.querySelectorAll('.bat-card');
                if (rows.length > 0) {
                    rows[rows.length - 1].remove();
                    updateAllTotals();
                }
            });

            function updateAllTotals() {
                const rows = batsContainer.querySelectorAll('.bat-card');
                let total = 0;
                let count = 0;

                rows.forEach(row => {
                    const packageType = (row.querySelector('.packageType')?.value || '').trim();
                    const qty = Math.max(1, parseInt(row.querySelector('.quantity')?.value || '1', 10) || 1);
                    let perItem = 0;
                    if (packageType && PRICE_MAP[packageType] !== undefined) {
                        perItem = PRICE_MAP[packageType];
                    }

                    // Calculate threading service price
                    let threadingPrice = 0;
                    const topChecked = row.querySelector('.threading-top')?.checked || false;
                    const bottomChecked = row.querySelector('.threading-bottom')?.checked || false;
                    const bothChecked = row.querySelector('.threading-both')?.checked || false;

                    if (bothChecked) {
                        threadingPrice = 150; // Both option selected
                    } else {
                        if (topChecked) threadingPrice += 100;
                        if (bottomChecked) threadingPrice += 100;
                    }

                    const lineTotal = (perItem + threadingPrice) * qty;
                    total += lineTotal;
                    count += qty;
                    if (row._priceEl) row._priceEl.textContent = `‚Çπ${lineTotal}`;
                });

                // Apply coupon discount if any
                const finalTotal = Math.max(0, total - (activeCouponDiscount || 0));

                summaryCountEl.textContent = count;
                summaryTotalEl.textContent = finalTotal;
            }

            paymentMethodSelect.addEventListener('change', updateAllTotals);

            // Coupon handling
            const couponInput = document.getElementById('discountCoupon');
            const applyCouponBtn = document.getElementById('applyCoupon');
            const couponFeedback = document.getElementById('couponFeedback');
            const couponSuccess = document.getElementById('couponSuccess');
            let activeCouponDiscount = 0;

            function validateCoupon(code) {
                if (!code) return { valid: false, message: 'Please enter a coupon code.' };

                const couponRegex = /^DA(\d+)$/;
                const match = code.match(couponRegex);
                if (!match) {
                    return {
                        valid: false,
                        message: 'Invalid coupon'
                    };
                }

                const amount = parseInt(match[1], 10);
                if (isNaN(amount) || amount === 0) {
                    return { valid: false, message: 'Invalid discount amount.' };
                }

                if (amount % 50 !== 0) {
                    return { valid: false, message: 'Discount amount must be a multiple of 50.' };
                }

                if (amount > 500) {
                    return { valid: false, message: 'Maximum discount amount is 500.' };
                }

                return { valid: true, amount, message: `Coupon applied! ‚Çπ${amount} discount is applied to your order.` };
            }

            function showCouponFeedback(isValid, message) {
                couponFeedback.style.display = isValid ? 'none' : 'block';
                couponSuccess.style.display = isValid ? 'block' : 'none';
                if (!isValid) {
                    couponFeedback.textContent = message || 'Invalid coupon';
                    couponInput.classList.add('is-invalid');
                    couponInput.classList.remove('is-valid');
                } else {
                    couponSuccess.textContent = message || 'Coupon applied successfully!';
                    couponInput.classList.add('is-valid');
                    couponInput.classList.remove('is-invalid');
                }
            }

            applyCouponBtn.addEventListener('click', function () {
                const code = couponInput.value.trim();
                if (!code) {
                    showCouponFeedback(false, 'Please enter a coupon code.');
                    return;
                }

                const { valid, amount } = validateCoupon(code);
                if (!valid) {
                    showCouponFeedback(false);
                    activeCouponDiscount = 0;
                } else if (amount <= 0 || amount > 500) {
                    showCouponFeedback(false, 'Invalid discount amount. Must be between 1 and 500.');
                    activeCouponDiscount = 0;
                } else {
                    activeCouponDiscount = amount;
                    showCouponFeedback(true, `Coupon applied! ‚Çπ${amount} discount will be applied to your order.`);
                }
                updateAllTotals();
            });

            couponInput.addEventListener('input', function () {
                couponInput.classList.remove('is-invalid', 'is-valid');
                couponFeedback.style.display = 'none';
                couponSuccess.style.display = 'none';
                activeCouponDiscount = 0;
                updateAllTotals();
            });

            addInitialRow();

            function validPhone(phone) {
                const digits = (phone || '').replace(/\D/g, '');
                return digits.length === 10;
            }

            function buildPayload() {
                const rows = batsContainer.querySelectorAll('.bat-card');
                const batDetails = [];

                rows.forEach(row => {
                    const batModel = row.querySelector('.batModel')?.value?.trim() || '';
                    const packageType = row.querySelector('.packageType')?.value || '';
                    const qty = Math.max(1, parseInt(row.querySelector('.quantity')?.value || '1', 10) || 1);
                    const packageCost = PRICE_MAP[packageType] || 0;

                    // Get threading service selections
                    const topChecked = row.querySelector('.threading-top')?.checked || false;
                    const bottomChecked = row.querySelector('.threading-bottom')?.checked || false;
                    const bothChecked = row.querySelector('.threading-both')?.checked || false;

                    let threadingCost = 0;
                    let threadingType = 'none';

                    if (bothChecked) {
                        threadingCost = 150;
                        threadingType = 'both';
                    } else if (topChecked && bottomChecked) {
                        threadingCost = 200;
                        threadingType = 'top+bottom';
                    } else if (topChecked) {
                        threadingCost = 100;
                        threadingType = 'top';
                    } else if (bottomChecked) {
                        threadingCost = 100;
                        threadingType = 'bottom';
                    }

                    const totalCost = packageCost + threadingCost;

                    if (batModel && packageType) {
                        batDetails.push({
                            batModel: batModel,
                            package: packageType,
                            threading: threadingType,
                            qty,
                            cost: totalCost,
                            breakdown: {
                                packageCost: packageCost,
                                threadingCost: threadingCost
                            },
                            id: `BAT_${crypto.randomUUID()}`
                        });
                    }
                });

                // Calculate original total before discounts
                const originalTotal = batDetails.reduce((sum, item) => {
                    return sum + (item.cost * item.qty);
                }, 0);

                // Get coupon details if applied
                const appliedCoupon = couponInput.value.trim();
                const { amount: couponAmount = 0 } = appliedCoupon ? validateCoupon(appliedCoupon) : { amount: 0 };

                return {
                    customerName: nameInput.value.trim(),
                    phone: phoneInput.value.replace(/\D/g, '').trim(),
                    store: storeSelect.value,
                    batDetails,
                    paymentMethod: paymentMethodSelect.value,
                    pickupDrop: pickupDrop?.checked || false,
                    testMode: testMode,
                    serviceType: 'bat-knocking',
                    payment: {
                        originalAmount: originalTotal,
                        discount: {
                            couponCode: appliedCoupon || null,
                            couponDiscount: couponAmount || 0
                        },
                        finalAmount: Math.max(0, originalTotal - (couponAmount || 0))
                    }
                };
            }

            function setButtonLoading(loading, text) {
                confirmButton.disabled = loading;
                confirmButton.innerHTML = loading ? `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> ${text || 'Processing...'}` : 'Pay Now';
            }

            // Track if a payment request is already in progress to prevent double submissions
            let paymentRequestInProgress = false;

            function checkMandatoryFields() {
                const missingFields = [];

                // Check store selection
                if (!storeSelect.value || storeSelect.value === '') {
                    missingFields.push('Store location (Please select Gaur City 1 or Gaur City 2)');
                }

                // Check customer name
                if (!nameInput.value.trim()) {
                    missingFields.push('Your name (Please enter your full name)');
                }

                // Check phone number
                const phoneValue = phoneInput.value.trim();
                if (!phoneValue) {
                    missingFields.push('WhatsApp number (Please enter your 10-digit phone number)');
                } else if (!/^\d{10}$/.test(phoneValue)) {
                    missingFields.push('Valid WhatsApp number (Must be exactly 10 digits)');
                }

                // Check if at least one bat is added
                const rows = batsContainer.querySelectorAll('.bat-card');
                if (rows.length === 0) {
                    missingFields.push('At least one bat (Click "+ Add Another Bat" to add a bat)');
                } else {
                    // Check each bat row for completeness
                    let hasValidBat = false;
                    for (let i = 0; i < rows.length; i++) {
                        const row = rows[i];
                        const batModel = row.querySelector('.batModel')?.value?.trim();
                        const packageType = row.querySelector('.packageType')?.value;

                        if (batModel && packageType) {
                            hasValidBat = true;
                        }
                    }

                    if (!hasValidBat) {
                        missingFields.push('Complete bat details (Each bat needs a model name and package selection)');
                    }
                }

                // Check payment method
                if (!paymentMethodSelect.value || paymentMethodSelect.value === '') {
                    missingFields.push('Payment method (Please select Online Payment or Cash)');
                }

                return missingFields;
            }

            async function onPayNowClicked(e) {
                e.preventDefault();

                // SET FLAG IMMEDIATELY to prevent race condition from rapid clicks
                if (paymentRequestInProgress) {
                    console.warn('‚ö†Ô∏è Payment request already in progress. Ignoring duplicate click.');
                    return;
                }
                paymentRequestInProgress = true;

                // First check all mandatory fields
                const missingFields = checkMandatoryFields();
                if (missingFields.length > 0) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert(`‚ö†Ô∏è Please complete the following required fields:\n\n${missingFields.map((field, index) => `${index + 1}. ${field}`).join('\n')}\n\nAll fields are required before proceeding with payment.`);
                    return;
                }

                // Detailed validation for each bat
                const rows = batsContainer.querySelectorAll('.bat-card');
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const batModel = row.querySelector('.batModel')?.value?.trim();
                    const packageType = row.querySelector('.packageType')?.value;

                    if (!batModel) {
                        paymentRequestInProgress = false;  // Reset flag on validation error
                        alert(`‚ùå Bat #${i + 1}: Please enter the bat model name.\n\nExample: "MRF Genius Grand Edition" or "SS TON English Willow"`);
                        // Focus on the bat model input
                        row.querySelector('.batModel')?.focus();
                        return;
                    }

                    if (!packageType) {
                        paymentRequestInProgress = false;  // Reset flag on validation error
                        alert(`‚ùå Bat #${i + 1}: Please select a knocking package.\n\nChoose from:\n‚Ä¢ Basic (10,000 balls - ‚Çπ800)\n‚Ä¢ Standard (15,000 balls - ‚Çπ1,100)\n‚Ä¢ Premium (20,000 balls - ‚Çπ1,500)\n‚Ä¢ Elite (25,000 balls - ‚Çπ1,800)\n‚Ä¢ Professional (30,000 balls - ‚Çπ2,000)`);
                        // Focus on the package select
                        row.querySelector('.packageType')?.focus();
                        return;
                    }
                }

                // Validate payload data
                const payload = buildPayload();

                if (!payload.store) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Store location is required.\n\nPlease select a store location from the dropdown.');
                    storeSelect.focus();
                    return;
                }

                if (!payload.customerName) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Your name is required.\n\nPlease enter your full name so we can identify your order.');
                    nameInput.focus();
                    return;
                }

                if (!payload.phone) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Phone number is required.\n\nPlease enter your 10-digit WhatsApp number for order updates.');
                    phoneInput.focus();
                    return;
                }

                if (!validPhone(payload.phone)) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Invalid phone number format.\n\nPlease enter a valid 10-digit WhatsApp number (without +91 or spaces).\n\nExample: 9876543210');
                    phoneInput.focus();
                    return;
                }

                if (!payload.batDetails || payload.batDetails.length === 0) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå No bat details found.\n\nPlease add at least one bat with complete information (model name and package selection).');
                    return;
                }

                const normalizedPaymentMethod = payload.paymentMethod?.toLowerCase() || '';
                if (!['online', 'payatoutlet'].includes(normalizedPaymentMethod)) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Payment method is required.\n\nPlease select either:\n‚Ä¢ Online Payment\n‚Ä¢ Cash (Pay at outlet)');
                    paymentMethodSelect.focus();
                    return;
                }

                // Check if total amount is valid
                const totalAmount = payload.payment.finalAmount;
                if (!totalAmount || totalAmount <= 0) {
                    paymentRequestInProgress = false;  // Reset flag on validation error
                    alert('‚ùå Invalid order total.\n\nPlease ensure you have selected at least one bat with a knocking package.');
                    return;
                }

                try {
                    paymentRequestInProgress = true;
                    setButtonLoading(true, 'Creating order...');

                    const createResp = await fetch(`${BACKEND_BASE}/api/create-order`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const createData = await createResp.json().catch(() => ({}));
                    if (!createData || !createData.success) {
                        setButtonLoading(false);
                        paymentRequestInProgress = false;
                        console.error('create-order failed', createData);
                        alert('Failed to create order. ' + (createData?.message || JSON.stringify(createData)));
                        return;
                    }

                    // Pay at outlet flow: redirect to order accepted
                    if (normalizedPaymentMethod === 'payatoutlet') {
                        const order = createData.order || createData.data || {};
                        const orderId = order.order_id || (createData.data && createData.data.order_id) || '';
                        const amount = (order.amount || createData.data?.amount || createData.amount || 0).toString();
                        const params = new URLSearchParams({ oid: orderId, amount, name: payload.customerName, store: payload.store });
                        window.location.href = `/order-accepted.html?${params.toString()}`;
                        return;
                    }

                    // ONLINE flow (Zoho Payment Session)
                    const resp = (createData.data || createData);
                    const paymentsSessionId = resp.payments_session_id || resp.paymentsSessionId || resp.payments_session || resp.payments_session_id;
                    const amount = resp.amount || resp.amount_due || summaryTotalEl.textContent || '';

                    if (!paymentsSessionId) {
                        setButtonLoading(false);
                        console.error('Missing payments_session_id from server', createData);
                        alert('Payment session creation failed on server.');
                        return;
                    }

                    const zpayConfig = resp.zpayConfig || { account_id: '60044148024', domain: 'IN' };
                    const apiKey = resp.zpayConfig?.api_key || ZOHO_WIDGET_API_KEY;
                    if (!zpayConfig.account_id || !apiKey) {
                        setButtonLoading(false);
                        console.error('Missing zpay config / api_key', zpayConfig);
                        alert('Payment widget configuration missing. Contact support.');
                        return;
                    }

                    const instance = new window.ZPayments({
                        account_id: String(zpayConfig.account_id),
                        domain: String(zpayConfig.domain || 'IN'),
                        otherOptions: {
                            api_key: apiKey
                        }
                    });

                    const widgetOptions = {
                        amount: (Number(amount) || 0).toString(),
                        currency_code: 'INR',
                        payments_session_id: String(paymentsSessionId),
                        currency_symbol: '‚Çπ',
                        business: 'DA SPORTZ',
                        description: 'Bat Knocking Service',
                        invoice_number: zpayConfig.invoice_number || '',
                        reference_number: zpayConfig.reference_number || '',
                        address: {
                            name: payload.customerName,
                            email: payload.email || (payload.phone + '@dasportz.com'),
                            phone: payload.phone
                        }
                    };

                    setButtonLoading(true, 'Opening checkout...');

                    let widgetResponse;
                    try {
                        widgetResponse = await instance.requestPaymentMethod(widgetOptions);
                    } catch (widgetErr) {
                        if (widgetErr && widgetErr.code === 'widget_closed') {
                            console.warn('Widget closed by user');
                            alert('Payment cancelled.');
                        } else if (widgetErr && widgetErr.code === 'invalid_payment_session') {
                            console.warn('Payment session invalid/expired');
                            alert('Payment session expired. Please try again.');
                        } else {
                            console.error('Widget error', widgetErr);
                            alert('Payment failed or was cancelled. Please try again.');
                        }
                        return;
                    } finally {
                        try { await instance.close(); } catch (_) { }
                    }

                    const paymentId = widgetResponse?.payment_id || widgetResponse?.payment?.payment_id || widgetResponse?.paymentId || widgetResponse?.paymentId_;
                    if (!paymentId) {
                        console.error('No payment_id returned from widget', widgetResponse);
                        alert('Payment could not be confirmed. Please contact support.');
                        return;
                    }

                    setButtonLoading(true, 'Verifying payment...');
                    const verifyResp = await fetch(`${BACKEND_BASE}/api/verify-payment`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ payment_id: paymentId })
                    });

                    const verifyData = await verifyResp.json().catch(() => ({}));
                    if (verifyData && verifyData.success) {
                        const orderId = resp.order_id || referenceId;
                        const params = new URLSearchParams({
                            pid: paymentId,
                            amount: amount.toString(),
                            name: payload.customerName,
                            oid: orderId,
                            service: 'bat-knocking'
                        });
                        window.location.href = `/payment-success.html?${params.toString()}`;
                        return;
                    } else {
                        console.error('Payment verify failed', verifyData);
                        alert('Payment was processed but verification failed. Please contact support with payment id: ' + paymentId);
                        return;
                    }

                } catch (err) {
                    console.error('Payment flow error', err);
                    alert('Something went wrong while processing payment. Please try again.');
                } finally {
                    paymentRequestInProgress = false;
                    setButtonLoading(false);
                }
            }

            confirmButton.addEventListener('click', onPayNowClicked);
        })();
    </script>

</body>

</html>